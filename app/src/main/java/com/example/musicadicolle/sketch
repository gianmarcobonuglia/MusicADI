import android.os.Bundle
import android.util.Log
import androidx.activity.ComponentActivity
import androidx.activity.compose.setContent
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.Surface
import androidx.compose.material3.Text
import androidx.compose.runtime.*
import androidx.compose.ui.Modifier
import androidx.compose.ui.tooling.preview.Preview
import com.example.musicadicolle.ui.theme.MusicADIColleTheme
import com.google.firebase.Firebase
import com.google.firebase.firestore.FirebaseFirestore
import kotlinx.coroutines.launch

class MainActivity : ComponentActivity() {

    private val db = FirebaseFirestore.getInstance()

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        setContent {
            MusicADIColleTheme {
                // A surface container using the 'background' color from the theme
                Surface(
                    modifier = Modifier.fillMaxSize(),
                    color = MaterialTheme.colorScheme.background
                ) {
                    FirestoreDataFetcher()
                }
            }
        }
    }
}

@Composable
fun FirestoreDataFetcher() {
    var userData by remember { mutableStateOf(emptyList<String>()) }
    val scope = rememberCoroutineScope()

    LaunchedEffect(key1 = true) {
        val userCollection = FirebaseFirestore.getInstance().collection("users")
        userCollection.get()
            .addOnSuccessListener { result ->
                val data = result.documents.mapNotNull { it.getString("first") }
                userData = data
            }
            .addOnFailureListener { exception ->
                Log.w("FirestoreDataFetcher", "Error getting documents.", exception)
            }
    }

    Column {
        Text("User Data:")
        userData.forEach { user ->
            Text(user)
        }
    }
}

@Preview(showBackground = true)
@Composable
fun PreviewFirestoreDataFetcher() {
    MusicADIColleTheme {
        FirestoreDataFetcher()
    }
}


package com.example.musicadicolle

import android.content.ContentValues.TAG
import android.os.Bundle
import android.util.Log
import androidx.activity.ComponentActivity
import androidx.activity.compose.setContent
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.Surface
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Modifier
import androidx.compose.ui.tooling.preview.Preview
import com.example.musicadicolle.ui.theme.MusicADIColleTheme
import com.google.firebase.Firebase
import com.google.firebase.firestore.firestore

class MainActivity : ComponentActivity() {
    // Access a Cloud Firestore instance from your Activity

    val db = Firebase.firestore
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        // Create a new user with a first and last name
        val user = hashMapOf(
            "first" to "Ada",
            "last" to "Lovelace",
            "born" to 1815,
        )

        // Create a new user with a first, middle, and last name
        val user1 = hashMapOf(
            "first" to "Alan",
            "middle" to "Mathison",
            "last" to "Turing",
            "born" to 1912,
        )

        setContent {
            MusicADIColleTheme {
                // A surface container using the 'background' color from the theme
                Surface(
                    modifier = Modifier.fillMaxSize(),
                    color = MaterialTheme.colorScheme.background
                ) {
                    Greeting("Android")

// Add a new document with a generated ID
        db.collection("users")
            .add(user)
            .addOnSuccessListener { documentReference ->
                Log.d(TAG, "DocumentSnapshot added with ID: ${documentReference.id}")
            }
            .addOnFailureListener { e ->
                Log.w(TAG, "Error adding document", e)
            }


// Add a new document with a generated ID
        db.collection("users")
            .add(user1)
            .addOnSuccessListener { documentReference ->
                Log.d(TAG, "DocumentSnapshot added with ID: ${documentReference.id}")
            }
            .addOnFailureListener { e ->
                Log.w(TAG, "Error adding document", e)
            }


        db.collection("users")
            .get()
            .addOnSuccessListener { result ->
                for (document in result) {
                    Log.d(TAG, "${document.id} => ${document.data}")
                }
            }
            .addOnFailureListener { exception ->
                Log.w(TAG, "Error getting documents.", exception)
            }


                }
            }
        }
    }
}

@Composable
fun Greeting(name: String, modifier: Modifier = Modifier) {
    Text(
        text = "Hello $name!",
        modifier = modifier
    )
}

@Preview(showBackground = true)
@Composable
fun GreetingPreview() {
    MusicADIColleTheme {
        Greeting("Android")
    }
}

package com.example.musicadicolle

import android.annotation.SuppressLint
import android.os.Bundle
import android.util.Log
import androidx.activity.ComponentActivity
import androidx.activity.compose.setContent
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.text.KeyboardOptions
import androidx.compose.material3.Button
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.OutlinedTextField
import androidx.compose.material3.Surface
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.runtime.LaunchedEffect
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.rememberCoroutineScope
import androidx.compose.runtime.setValue
import androidx.compose.ui.Modifier
import androidx.compose.ui.text.input.KeyboardType
import androidx.compose.ui.tooling.preview.Preview
import com.example.musicadicolle.ui.theme.MusicADIColleTheme
import com.google.firebase.firestore.FirebaseFirestore
import com.google.firebase.firestore.auth.User

class MainActivity : ComponentActivity() {

    private val db = FirebaseFirestore.getInstance()
    data class UserData(val first: String, val last: String, val born: Int)


    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        setContent {
            MusicADIColleTheme {
                // A surface container using the 'background' color from the theme
                Surface(
                    modifier = Modifier.fillMaxSize(),
                    color = MaterialTheme.colorScheme.background
                ) {
                    FirestoreDataFetcher(db)
                }
            }
        }
    }
}

@Composable
fun AddUserData(db: FirebaseFirestore) {
    var firstName by remember { mutableStateOf("") }
    var lastName by remember { mutableStateOf("") }
    var born by remember { mutableStateOf("") }

    Column {
        OutlinedTextField(
            value = firstName,
            onValueChange = { firstName = it },
            label = { Text("First Name") }
        )
        OutlinedTextField(
            value = lastName,
            onValueChange = { lastName = it },
            label = { Text("Last Name") }
        )
        OutlinedTextField(
            value = born,
            onValueChange = { born = it },
            label = { Text("Year of Birth") },
            keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Number)
        )

        Button(
            onClick = {
                // Verifica che tutti i campi siano compilati
                if (firstName.isNotEmpty() && lastName.isNotEmpty() && born.isNotEmpty()) {
                    // Aggiungi i dati al database Firestore
                    val userData = hashMapOf(
                        "first" to firstName,
                        "last" to lastName,
                        "born" to born.toInt() // Conversione della stringa in Int
                    )

                    db.collection("users")
                        .add(userData)
                        .addOnSuccessListener { documentReference ->
                            Log.d("AddUserData", "DocumentSnapshot added with ID: ${documentReference.id}")
                            // Resetta i campi dopo l'inserimento
                            firstName = ""
                            lastName = ""
                            born = ""
                        }
                        .addOnFailureListener { e ->
                            Log.w("AddUserData", "Error adding document", e)
                        }
                }
            },
            enabled = firstName.isNotEmpty() && lastName.isNotEmpty() && born.isNotEmpty()
        ) {
            Text("Add User Data")
        }
    }
}

@Composable
fun FirestoreDataFetcher(db: FirebaseFirestore) {
    var userData by remember { mutableStateOf(emptyList<MainActivity.UserData>()) }
    val scope = rememberCoroutineScope()

    LaunchedEffect(key1 = true) {
        // Recupera tutti i documenti dalla collezione "users"
        val userCollection = db.collection("users")
        userCollection.get()
            .addOnSuccessListener { result ->
                val users = result.documents.mapNotNull { document ->
                    val first = document.getString("first")
                    val last = document.getString("last")
                    val born = document.getLong("born")?.toInt()

                    first?.let { MainActivity.UserData(it, last ?: "", born ?: 0) }
                }
                userData = users
            }
            .addOnFailureListener { exception ->
                Log.w("FirestoreDataFetcher", "Error getting documents.", exception)
            }
    }

    Column {
        Text("User Data:")
        userData.forEach { user ->
            Column {
                Text("First Name: ${user.first}")
                Text("Last Name: ${user.last}")
                Text("Born: ${user.born}")
            }
        }
        AddUserData(db) // Aggiungi il widget per l'aggiunta di nuovi dati utente
    }
}


@Preview(showBackground = true)
@Composable
fun PreviewFirestoreDataFetcher() {
    MusicADIColleTheme {
        FirestoreDataFetcher(FirebaseFirestore.getInstance())
    }
}


App main

package com.example.musicadicolle

import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.padding
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.filled.AccountCircle
import androidx.compose.material.icons.filled.Add
import androidx.compose.material.icons.filled.Edit
import androidx.compose.material.icons.filled.Menu
import androidx.compose.material.icons.filled.Settings
import androidx.compose.material3.BottomAppBar
import androidx.compose.material3.BottomAppBarDefaults
import androidx.compose.material3.FloatingActionButton
import androidx.compose.material3.FloatingActionButtonDefaults
import androidx.compose.material3.Icon
import androidx.compose.material3.IconButton
import androidx.compose.material3.Scaffold
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.ui.Modifier
import androidx.compose.ui.unit.dp
import androidx.lifecycle.viewmodel.compose.viewModel

import androidx.navigation.NavHostController

@Composable
fun AppMainScreen(navController: NavHostController) {

    Box(modifier = Modifier.fillMaxSize()) {
        Scaffold(
            bottomBar = {
                BottomAppBar(
                    actions = {
                        IconButton(onClick = { navController.navigate("elenco") }) {
                            Icon(
                                Icons.Filled.Menu,
                                contentDescription = "Elenco"
                            )
                        }

                        IconButton(onClick = { navController.navigate("modifica") }) {
                            Icon(
                                Icons.Filled.Edit,
                                contentDescription = "Modifica",
                            )
                        }
                        IconButton(onClick = { navController.navigate("spartiti") }) {
                            Icon(
                                Icons.Filled.AccountCircle,
                                contentDescription = "Spartito",
                            )
                        }
                        IconButton(onClick = { navController.navigate("testo") }) {
                            Icon(
                                Icons.Filled.Settings,
                                contentDescription = "Testo",
                            )
                        }
                    },
                    floatingActionButton = {

                        FloatingActionButton(
                            onClick = { navController.navigate("aggiungi") },
                            containerColor = BottomAppBarDefaults.bottomAppBarFabColor,
                            elevation = FloatingActionButtonDefaults.bottomAppBarFabElevation()
                        ) {
                            Icon(Icons.Filled.Add, "Aggiungi")
                        }
                    }
                )
            },
        ) { innerPadding ->
            IconButton(onClick = { navController.navigate("account") }) {
                Icon(
                    Icons.Filled.AccountCircle,
                    contentDescription = "Account",
                )
            }
            Spacer(modifier = Modifier.padding(top = 16.dp))
            Text(
                modifier = Modifier.padding(innerPadding),
                text = "Scegli una funzionalità."
            )
        }
    }
}



LOGIN

@Composable
    fun LoginScreen(navController: NavController) {

        var googleSignInClient: GoogleSignInClient? = null
        val context = LocalContext.current
        val coroutineScope = rememberCoroutineScope()
        val auth = FirebaseAuth.getInstance()

        Surface(
            modifier = Modifier
                .fillMaxSize(),
            color = MaterialTheme.colorScheme.background
        ) {
            Column(
                modifier = Modifier.fillMaxSize(),
                verticalArrangement = Arrangement.Center,
                horizontalAlignment = Alignment.CenterHorizontally
            ) {
                TypewriterTextEffect(
                    modifier = Modifier
                        .align(Alignment.CenterHorizontally)
                        .fillMaxWidth(),
                    text = " Benvenuto...",
                )
                { displayedText ->
                    Text(
                        modifier = Modifier
                            .fillMaxWidth()
                            .align(Alignment.CenterHorizontally),
                        text = displayedText,
                        style = MaterialTheme.typography.headlineLarge,
                        textAlign = TextAlign.Center,
                    )
                }
                Spacer(modifier = Modifier.height(32.dp))
                Button(onClick = {
                    val gso = GoogleSignInOptions.Builder(GoogleSignInOptions.DEFAULT_SIGN_IN)
                        .requestIdToken(context.getString(R.string.default_web_client_id))
                        .requestEmail()
                        .build()

                    googleSignInClient = GoogleSignIn.getClient(context, gso)
                    val signInIntent =
                        googleSignInClient?.signInIntent ?: return@Button // Handle null case

                    if (context is Activity) {
                        (context as Activity).startActivityForResult(signInIntent, RC_SIGN_IN, null)
                    }
                }) {
                    Text("Accedi con Google")
                }
                Text(
                    errorMessage,
                    textAlign = TextAlign.Center,
                    color = MaterialTheme.colorScheme.error
                )
            }
        }
    }


    @Composable
    fun TypewriterTextEffect(
        modifier: Modifier = Modifier,
        text: String,
        minDelayInMillis: Long = 10,
        maxDelayInMillis: Long = 150,
        minCharacterChunk: Int = 1,
        maxCharacterChunk: Int = 1,
        displayTextComposable: @Composable (displayedText: String) -> Unit,
    ) {
        // Ensure minDelayInMillis is less than or equal to maxDelayInMillis
        require(minDelayInMillis <= maxDelayInMillis) {
            "TypewriterTextEffect: Invalid delay range. minDelayInMillis ($minDelayInMillis) must be less than or equal to maxDelayInMillis ($maxDelayInMillis)."
        }

        // Ensure minCharacterChunk is less than or equal to maxCharacterChunk
        require(minCharacterChunk <= maxCharacterChunk) {
            "TypewriterTextEffect: Invalid character chunk range. minCharacterChunk ($minCharacterChunk) must be less than or equal to maxCharacterChunk ($maxCharacterChunk)."
        }

        // Initialize and remember the displayedText
        var displayedText by remember { mutableStateOf("") }

        // Call the displayTextComposable with the current displayedText value
        displayTextComposable(displayedText)

        // Launch the effect to update the displayedText value over time
        LaunchedEffect(Unit) {
            while (true) {
                val textLength = text.length
                var endIndex = 0

                // Forward animation (typing)
                while (endIndex < textLength) {
                    endIndex = minOf(
                        endIndex + Random.nextInt(minCharacterChunk, maxCharacterChunk + 1),
                        textLength
                    )
                    displayedText = text.substring(startIndex = 0, endIndex = endIndex)
                    delay(Random.nextLong(minDelayInMillis, maxDelayInMillis))
                }

                // Delay before starting backward animation
                delay(1500)

                // Backward animation (deleting)
                while (endIndex > 0) {
                    endIndex -= Random.nextInt(minCharacterChunk, maxCharacterChunk + 1)
                    displayedText =
                        text.substring(startIndex = 0, endIndex = endIndex.coerceAtLeast(0))
                    delay(Random.nextLong(minDelayInMillis, maxDelayInMillis))
                }
            }
        }
    }























    LOGIN

    @file:Suppress("DEPRECATION")

    package com.example.musicadicolle

    import android.util.Log
    import android.widget.Toast
    import androidx.activity.compose.rememberLauncherForActivityResult
    import androidx.activity.result.contract.ActivityResultContracts
    import androidx.compose.foundation.Image
    import androidx.compose.foundation.border
    import androidx.compose.foundation.layout.Arrangement
    import androidx.compose.foundation.layout.Column
    import androidx.compose.foundation.layout.Row
    import androidx.compose.foundation.layout.Spacer
    import androidx.compose.foundation.layout.fillMaxSize
    import androidx.compose.foundation.layout.fillMaxWidth
    import androidx.compose.foundation.layout.height
    import androidx.compose.foundation.layout.padding
    import androidx.compose.foundation.layout.size
    import androidx.compose.foundation.layout.width
    import androidx.compose.foundation.shape.CircleShape
    import androidx.compose.material3.Button
    import androidx.compose.material3.ButtonColors
    import androidx.compose.material3.ButtonDefaults
    import androidx.compose.material3.Icon
    import androidx.compose.material3.MaterialTheme
    import androidx.compose.material3.OutlinedTextField
    import androidx.compose.material3.Surface
    import androidx.compose.material3.Text
    import androidx.compose.runtime.Composable
    import androidx.compose.runtime.LaunchedEffect
    import androidx.compose.runtime.getValue
    import androidx.compose.runtime.mutableStateOf
    import androidx.compose.runtime.remember
    import androidx.compose.runtime.setValue
    import androidx.compose.ui.Alignment
    import androidx.compose.ui.Modifier
    import androidx.compose.ui.graphics.BlendMode
    import androidx.compose.ui.graphics.Color
    import androidx.compose.ui.graphics.ColorFilter
    import androidx.compose.ui.graphics.painter.Painter
    import androidx.compose.ui.platform.LocalContext
    import androidx.compose.ui.res.painterResource
    import androidx.compose.ui.text.style.TextAlign
    import androidx.compose.ui.unit.dp
    import androidx.navigation.NavHostController
    import com.google.android.gms.auth.api.signin.GoogleSignIn
    import com.google.android.gms.auth.api.signin.GoogleSignInOptions
    import com.google.android.gms.common.api.ApiException
    import com.google.firebase.Firebase
    import com.google.firebase.auth.FirebaseAuth
    import com.google.firebase.auth.FirebaseUser
    import com.google.firebase.auth.GoogleAuthProvider
    import com.google.firebase.auth.auth
    import com.google.firebase.firestore.firestore
    import kotlinx.coroutines.delay
    import kotlin.random.Random

    @Composable
    fun LoginScreen(navController: NavHostController) {

        val context = LocalContext.current
        var email by remember { mutableStateOf("") }
        var password by remember { mutableStateOf("") }
        var errorMessage by remember { mutableStateOf("") }

        val auth = Firebase.auth

        // Funzione per ottenere il risultato dell'accesso con Google
        val launcher =
            rememberLauncherForActivityResult(ActivityResultContracts.StartActivityForResult()) { result ->
                val task = GoogleSignIn.getSignedInAccountFromIntent(result.data)
                try {
                    // Ottenere l'account Google
                    val account = task.getResult(ApiException::class.java)
                    // Ottenere l'idToken dall'account Google
                    val idToken = account?.idToken
                    // Autenticare l'utente con Firebase utilizzando l'idToken
                    if (idToken != null) {
                        val credential = GoogleAuthProvider.getCredential(idToken, null)
                        auth.signInWithCredential(credential)
                            .addOnCompleteListener { authTask ->
                                Log.d(
                                    "LoginScreen",
                                    "signInWithCredential:onComplete:" + authTask.isSuccessful
                                )
                                if (authTask.isSuccessful) {
                                    // Login successful
                                    val user = auth.currentUser
                                    if (user != null) {
                                        val Account = Account.fromFirebaseUser(user)

                                        Account?.name = user.displayName.toString()
                                        Account?.email = user.email.toString()
                                        Account?.photoUrl = user.photoUrl.toString()
                                        Account?.idToken = user.uid

                                        val db = Firebase.firestore

                                        val userMap = hashMapOf(
                                            "name" to Account?.name,
                                            "email" to Account?.email,
                                            "idToken" to Account?.idToken,
                                        )

                                        db.collection("Utenti").document("${user.uid}")
                                            .get()
                                            .addOnSuccessListener { documentSnapshot ->
                                                if (documentSnapshot.exists()) {
                                                    Log.d("LoginScreen", "Document exists")
                                                    navController.navigate("mainscreen")
                                                } else {
                                                    db.collection("Utenti").document("${user.uid}")
                                                        .set(userMap)
                                                        .addOnSuccessListener {
                                                            Log.d(
                                                                "LoginScreen",
                                                                "User data successfully written!"
                                                            )
                                                            navController.navigate("mainscreen")
                                                        }
                                                        .addOnFailureListener { e ->
                                                            Log.w(
                                                                "LoginScreen",
                                                                "Error writing user data",
                                                                e
                                                            )
                                                        }
                                                }
                                            }


                                    }
                                } else {
                                    // Login failed
                                    errorMessage = "Errore durante il login"
                                    Log.e("LoginScreen", errorMessage)
                                    Log.e("LoginScreen", authTask.exception.toString())
                                    Log.e("LoginScreen", "IdToken: $idToken")
                                    Log.e("LoginScreen", "Credentials: $credential")
                                }
                            }
                            .addOnFailureListener { e ->
                                // Handle sign-in failure
                                Log.w("LoginScreen", "signInWithCredential:failed", e)
                                errorMessage = "Errore durante l'accesso con Google"
                                Log.e("LoginScreen", errorMessage)
                            }
                    } else {
                        errorMessage = "IdToken non disponibile"
                        Log.e("LoginScreen", errorMessage)
                    }
                } catch (e: ApiException) {
                    // Handle sign-in failure
                    Log.w("LoginScreen", "signInResult:failed code=" + e.statusCode + e.status)
                    errorMessage = "Errore durante l'accesso con Google: ${e.message}"
                    Log.e("LoginScreen", errorMessage)
                }
            }

        Surface(
            modifier = Modifier
                .fillMaxSize(),
            color = MaterialTheme.colorScheme.background
        ) {
            Column(
                modifier = Modifier
                    .fillMaxSize()
                    .padding(16.dp),
                verticalArrangement = Arrangement.Center,
                horizontalAlignment = Alignment.CenterHorizontally
            ) {

                TypewriterTextEffect(
                    modifier = Modifier
                        .align(Alignment.CenterHorizontally)
                        .fillMaxWidth(),
                    text = " Benvenuto...",
                )
                { displayedText ->
                    Text(
                        modifier = Modifier
                            .fillMaxWidth()
                            .align(Alignment.CenterHorizontally),
                        text = displayedText,
                        style = MaterialTheme.typography.headlineLarge,
                        textAlign = TextAlign.Center,
                    )
                }
                Spacer(modifier = Modifier.height(64.dp))

                OutlinedTextField(
                    value = email,
                    onValueChange = { email = it },
                    label = { Text("Email") },
                    modifier = Modifier.fillMaxWidth(),
                    shape = MaterialTheme.shapes.large
                )

                Spacer(modifier = Modifier.height(8.dp))

                OutlinedTextField(
                    value = password,
                    onValueChange = { password = it },
                    label = { Text("Password") },
                    modifier = Modifier.fillMaxWidth(),
                    shape = MaterialTheme.shapes.large
                )

                Spacer(modifier = Modifier.height(32.dp))

                Row(
                    verticalAlignment = Alignment.CenterVertically,
                    horizontalArrangement = Arrangement.Center
                ) {
                    Button(
                        modifier = Modifier
                            .border(
                                1.5.dp,
                                Color.Black,
                                CircleShape
                            )
                            .size(170.dp, 50.dp),
                        onClick = {
                            if(email.isEmpty() && password.isEmpty())
                                errorMessage = "Compilare tutti i campi"
                            else
                            auth.signInWithEmailAndPassword(email, password)
                                .addOnCompleteListener { task ->
                                    if (task.isSuccessful) {
                                        // Sign in success, update UI with the signed-in user's information
                                        Log.d("TAG", "signInWithEmail:success")
                                        val user = auth.currentUser

                                        navController.navigate("mainscreen")

                                    } else {
                                        // If sign in fails, display a message to the user.
                                        Log.w("TAG", "signInWithEmail:failure", task.exception)
                                    }
                                }
                        },
                        colors = ButtonDefaults.buttonColors(
                            containerColor = Color.White,
                            contentColor = MaterialTheme.colorScheme.onPrimary
                        )
                    ) {
                        Text(text = "Accedi!", color = Color.Black)
                    }

                    Spacer(modifier = Modifier.width(16.dp))

                    Button(
                        modifier = Modifier
                            .border(1.5.dp, Color.Black, CircleShape)
                            .size(170.dp, 50.dp),
                        onClick = {
                            if(email.isEmpty() && password.isEmpty())
                                errorMessage = "Compilare tutti i campi"
                            else
                            auth.createUserWithEmailAndPassword(email, password)
                                .addOnCompleteListener { task ->
                                    if (task.isSuccessful) {
                                        // Sign in success, update UI with the signed-in user's information
                                        Log.d("TAG", "createUserWithEmail:success")
                                        val user = auth.currentUser
                                    } else {
                                        // If sign in fails, display a message to the user.
                                        Log.w("TAG", "createUserWithEmail:failure", task.exception)

                                    }
                                }
                        },
                        colors = ButtonDefaults.buttonColors(
                            containerColor = Color.White,
                            contentColor = MaterialTheme.colorScheme.onPrimary
                        )
                    ) {
                        Text(text = "Registrati!", color = Color.Black)
                    }
                }


                Spacer(modifier = Modifier.height(32.dp))

                Button(
                    modifier = Modifier
                        .border(1.5.dp, Color.Red, CircleShape)
                        .size(170.dp, 50.dp),
                    onClick = {
                        // Creazione dell'intento di accesso con Google
                        val signInIntent = GoogleSignIn.getClient(
                            context,
                            GoogleSignInOptions.Builder(GoogleSignInOptions.DEFAULT_SIGN_IN)
                                .requestIdToken(context.getString(R.string.default_web_client_id))
                                .requestEmail()
                                .build()
                        ).signInIntent
                        // Avvio dell'attività per il login con Google
                        launcher.launch(signInIntent)
                    },
                    colors = ButtonDefaults.buttonColors(
                        containerColor = Color.White,
                        contentColor = MaterialTheme.colorScheme.onPrimary
                    )
                ) {
                    Row(
                        verticalAlignment = Alignment.CenterVertically,
                        horizontalArrangement = Arrangement.Center
                    ) {
                        val logo: Painter =
                            painterResource(id = R.drawable.google_logo) // Il tuo logo Apple
                        Image(
                            painter = logo,
                            contentDescription = "Google Logo",
                            modifier = Modifier.size(24.dp),
                            colorFilter = ColorFilter.tint(Color.White, blendMode = BlendMode.Color)
                        )
                        Spacer(modifier = Modifier.width(8.dp))
                        Text(text = "Accedi con Google", color = Color.Black)
                    }
                }
                Spacer(modifier = Modifier.height(8.dp))

                Button(
                    modifier = Modifier
                        .border(1.5.dp, Color.Blue, CircleShape)
                        .size(170.dp, 50.dp),
                    onClick = { /*TODO*/ },
                    colors = ButtonDefaults.buttonColors(
                        containerColor = Color.White,
                        contentColor = MaterialTheme.colorScheme.onPrimary
                    ),
                ) {
                    Row(
                        verticalAlignment = Alignment.CenterVertically,
                        horizontalArrangement = Arrangement.Center
                    ) {
                        val logo: Painter =
                            painterResource(id = R.drawable.facebook_logo) // Il tuo logo Apple
                        Image(
                            painter = logo,
                            contentDescription = "Facebook Logo",
                            modifier = Modifier.size(24.dp),
                            colorFilter = ColorFilter.tint(Color.White, blendMode = BlendMode.Color)
                        )
                        Spacer(modifier = Modifier.width(8.dp))
                        Text(text = "Accedi con Facebook", color = Color.Black)
                    }
                }

                Spacer(modifier = Modifier.height(8.dp))

                Button(
                    modifier = Modifier
                        .border(1.5.dp, Color.Black, CircleShape)
                        .size(170.dp, 50.dp),
                    onClick = { /*TODO*/ },
                    colors = ButtonDefaults.buttonColors(
                        containerColor = Color.White,
                        contentColor = MaterialTheme.colorScheme.onPrimary
                    ),
                ) {
                    Row(
                        verticalAlignment = Alignment.CenterVertically,
                        horizontalArrangement = Arrangement.Center
                    ) {
                        val logo: Painter =
                            painterResource(id = R.drawable.twitter_logo) // Il tuo logo Apple
                        Image(
                            painter = logo,
                            contentDescription = "X Logo",
                            modifier = Modifier.size(24.dp),
                            colorFilter = ColorFilter.tint(Color.White, blendMode = BlendMode.Color)
                        )
                        Spacer(modifier = Modifier.width(8.dp))
                        Text(text = "Accedi con X", color = Color.Black)
                    }
                }

                Spacer(modifier = Modifier.height(8.dp))

                Button(
                    modifier = Modifier
                        .border(1.5.dp, Color.LightGray, CircleShape)
                        .size(170.dp, 50.dp),
                    onClick = { /*TODO*/ },
                    colors = ButtonDefaults.buttonColors(
                        containerColor = Color.White,
                        contentColor = MaterialTheme.colorScheme.onPrimary
                    ),
                ) {
                    Row(
                        verticalAlignment = Alignment.CenterVertically,
                        horizontalArrangement = Arrangement.Center
                    ) {
                        val logo: Painter =
                            painterResource(id = R.drawable.apple_logo) // Il tuo logo Apple
                        Image(
                            painter = logo,
                            contentDescription = "Apple Logo",
                            modifier = Modifier.size(24.dp),
                        )
                        Spacer(modifier = Modifier.width(8.dp))
                        Text(text = "Accedi con Apple", color = Color.Black)
                    }
                }

                Spacer(modifier = Modifier.height(8.dp))

                Text(
                    text = errorMessage,
                    textAlign = TextAlign.Center,
                    color = MaterialTheme.colorScheme.error
                )
            }
        }
    }


    @Composable
    fun TypewriterTextEffect(
        modifier: Modifier = Modifier,
        text: String,
        minDelayInMillis: Long = 10,
        maxDelayInMillis: Long = 150,
        minCharacterChunk: Int = 1,
        maxCharacterChunk: Int = 1,
        displayTextComposable: @Composable (displayedText: String) -> Unit,
    ) {
        // Ensure minDelayInMillis is less than or equal to maxDelayInMillis
        require(minDelayInMillis <= maxDelayInMillis) {
            "TypewriterTextEffect: Invalid delay range. minDelayInMillis ($minDelayInMillis) must be less than or equal to maxDelayInMillis ($maxDelayInMillis)."
        }

        // Ensure minCharacterChunk is less than or equal to maxCharacterChunk
        require(minCharacterChunk <= maxCharacterChunk) {
            "TypewriterTextEffect: Invalid character chunk range. minCharacterChunk ($minCharacterChunk) must be less than or equal to maxCharacterChunk ($maxCharacterChunk)."
        }

        // Initialize and remember the displayedText
        var displayedText by remember { mutableStateOf("") }

        // Call the displayTextComposable with the current displayedText value
        displayTextComposable(displayedText)

        // Launch the effect to update the displayedText value over time
        LaunchedEffect(Unit) {
            while (true) {
                val textLength = text.length
                var endIndex = 0

                // Forward animation (typing)
                while (endIndex < textLength) {
                    endIndex = minOf(
                        endIndex + Random.nextInt(minCharacterChunk, maxCharacterChunk + 1),
                        textLength
                    )
                    displayedText = text.substring(startIndex = 0, endIndex = endIndex)
                    delay(Random.nextLong(minDelayInMillis, maxDelayInMillis))
                }

                // Delay before starting backward animation
                delay(1500)

                // Backward animation (deleting)
                while (endIndex > 0) {
                    endIndex -= Random.nextInt(minCharacterChunk, maxCharacterChunk + 1)
                    displayedText =
                        text.substring(startIndex = 0, endIndex = endIndex.coerceAtLeast(0))
                    delay(Random.nextLong(minDelayInMillis, maxDelayInMillis))
                }
            }
        }
    }




















Box(
modifier = Modifier
.background(
MaterialTheme.colorScheme.secondaryContainer,
shape = RoundedCornerShape(18.dp, 18.dp, 0.dp, 0.dp)
)
.fillMaxWidth()
.fillMaxHeight(),
) {
Column(
modifier = Modifier
.fillMaxWidth()
.padding(6.dp),
) {
OutlinedTextField(
value = email,
onValueChange = { email = it },
label = { Text("Email") },
modifier = Modifier.fillMaxWidth(),
shape = MaterialTheme.shapes.large
)
Spacer(modifier = Modifier.height(24.dp))
OutlinedTextField(
value = password,
onValueChange = { password = it },
label = { Text("Password") },
modifier = Modifier.fillMaxWidth(),
shape = MaterialTheme.shapes.large,
visualTransformation = PasswordVisualTransformation(
mask = '\u2022'
)
)
Spacer(modifier = Modifier.height(24.dp))
Row(
modifier = Modifier.fillMaxWidth(),
horizontalArrangement = Arrangement.SpaceEvenly
) {
Button(onClick = {
if (email.isEmpty() && password.isEmpty())
errorMessage = "Compilare tutti i campi"
else
signInEmail.signInWithEmail(
email,
password,
navController,
navigationViewModel
)
}) {
Text(text = "Accedi!")
}
Spacer(modifier = Modifier.width(60.dp))
Button(
onClick = {
if (email.isEmpty() && password.isEmpty())
errorMessage = "Compilare tutti i campi"
else
signUpEmail.signUp(email, password)
}
) {
Text(text = "Registrati!")
}
}
}

Spacer(modifier = Modifier.height(50.dp))

Column(
modifier = Modifier
.padding(16.dp)
.fillMaxWidth(),
)
{
Row(
verticalAlignment = Alignment.CenterVertically
) {
IconButton(
colors = IconButtonColors(
containerColor = MaterialTheme.colorScheme.primary,
contentColor = MaterialTheme.colorScheme.onPrimary,
disabledContainerColor = Color.Gray,
disabledContentColor = Color.White
),
onClick = {
signInWithGoogleHelper.launchSignIn(googleSignInLauncher)
}
) {
Icon(
painter = painterResource(id = R.drawable.google_logo),
contentDescription = "Login con Google"
)
}
Spacer(Modifier.width(24.dp))
Text(text = "Accedi con Google")
}
Spacer(modifier = Modifier.height(21.dp))
Row(
verticalAlignment = Alignment.CenterVertically
) {
IconButton(
colors = IconButtonColors(
containerColor = MaterialTheme.colorScheme.primary,
contentColor = MaterialTheme.colorScheme.onPrimary,
disabledContainerColor = Color.Gray,
disabledContentColor = Color.White
),
onClick = {
/*TODO*/
}

) {
Icon(
painter = painterResource(id = R.drawable.apple_logo),
contentDescription = "Login con Apple"
)
}
Spacer(Modifier.width(24.dp))
Text(text = "Accedi con Apple")
}
Spacer(modifier = Modifier.height(21.dp))
Row(
verticalAlignment = Alignment.CenterVertically
) {
IconButton(
colors = IconButtonColors(
containerColor = MaterialTheme.colorScheme.primary,
contentColor = MaterialTheme.colorScheme.onPrimary,
disabledContainerColor = Color.Gray,
disabledContentColor = Color.White
),
onClick = { /*TODO*/ }) {
Icon(
painter = painterResource(id = R.drawable.facebook_logo),
contentDescription = "Login con Facebook"
)
}
Spacer(Modifier.width(24.dp))
Text(text = "Accedi con Facebook")
}
Spacer(modifier = Modifier.height(21.dp))
Row(
verticalAlignment = Alignment.CenterVertically
) {
IconButton(
colors = IconButtonColors(
containerColor = MaterialTheme.colorScheme.primary,
contentColor = MaterialTheme.colorScheme.onPrimary,
disabledContainerColor = Color.Gray,
disabledContentColor = Color.White
),
onClick = { /*TODO*/ }
) {
Icon(
painter = painterResource(id = R.drawable.twitter_logo),
contentDescription = "Login con Twitter"
)
}
Spacer(Modifier.width(24.dp))
Text(text = "Accedi con Twitter/X")
}
}
}







